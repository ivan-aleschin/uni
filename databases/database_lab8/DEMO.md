2. **Ограничения на модификацию** - не все представления можно изменять
3. **Усложнение отладки** - труднее отследить происхождение данных
# ДЕМОНСТРАЦИЯ РАБОТЫ ПРОГРАММЫ
---

## СКРИНШОТЫ ДЛЯ ОТЧЕТА
- Функция `detectSQLInjection()` - обнаружение опасных паттернов
При демонстрации сделайте скриншоты:
1. Успешного подключения администратора
2. CRUD операций (добавление, изменение, удаление оценки)
3. Обнаружения SQL-инъекции с предупреждением
4. Работы от имени junior пользователя
5. Попытки junior изменить данные (должна быть ошибка доступа)
6. Результатов работы представления (если реализовано)
### ✅ Задание 2.2: Предупреждение об инъекции
---
- Вредоносный запрос блокируется
## ЗАВЕРШЕНИЕ РАБОТЫ

После демонстрации:
1. Закройте программу (выберите `0` в меню)
2. Соединение с БД автоматически закроется
3. Проверьте в DataGrip, что изменения применились корректно
### ✅ Задание 3.1: Аутентификация с ролями
- Роль `sab_admin` - полные права (CREATE, READ, UPDATE, DELETE)
- Роль `sab_junior` - только чтение (READ)

### ✅ Задание 3.2: CRUD операции
- **Create**: Добавление оценок
- **Read**: Просмотр оценок
- **Update**: Изменение оценок
- **Delete**: Удаление оценок

---

## ПОШАГОВАЯ ДЕМОНСТРАЦИЯ

### Шаг 1: Подготовка базы данных

1. **Откройте DataGrip** и подключитесь к вашей базе данных PostgreSQL
2. **Восстановите базу данных students** (если еще не сделали):
   ```sql
   -- Выполните файл students_dump.sql в DataGrip
   ```

3. **Создайте роли пользователей**:
   - Откройте файл `setup_roles.sql` в DataGrip
   - Выполните весь скрипт (Ctrl+Enter)
   - Проверьте, что роли созданы:
   ```sql
   SELECT rolname, rolsuper, rolcreatedb, rolcanlogin
   FROM pg_roles
   WHERE rolname IN ('sab_admin', 'sab_junior');
   ```

### Шаг 2: Компиляция программы

#### Вариант 1: Использование compile.bat (рекомендуется для Windows)
1. Откройте терминал в папке проекта
2. Запустите: `compile.bat`
3. При успешной компиляции появится файл `database_lab8.exe`

#### Вариант 2: Использование CLion
1. Откройте проект в CLion
2. Настройте CMake (File → Settings → Build → CMake)
3. Нажмите Build (Ctrl+F9)
4. Запустите программу (Shift+F10)

### Шаг 3: Демонстрация работы администратора

1. **Запустите программу**: `database_lab8.exe`
2. **Выберите**: `1` (Администратор)
3. **Введите логин**: `sab_admin`
4. **Введите пароль**: `123456`

#### Тест 1: Просмотр оценок студента
- Выберите пункт меню: `4`
- Введите ID студента (например: `856271`)
- Должны отобразиться все оценки этого студента

#### Тест 2: Изменение оценки
- Выберите пункт меню: `2` (Изменить оценку)
- Введите ID студента: `856271`
- Введите ID дисциплины: `1` (например, Базы данных)
- Введите новую оценку: `5`
- Проверьте изменение через пункт меню `4`

#### Тест 3: Добавление новой оценки
- Выберите пункт меню: `1` (Добавить оценку)
- Введите данные для новой оценки

#### Тест 4: Удаление оценки
- Выберите пункт меню: `3` (Удалить оценку)
- Введите ID студента и дисциплины
- Оценка будет удалена

#### Тест 5: Защита от SQL-инъекций (как администратор)
- Выберите пункт меню: `5`
- Введите ID студента: `856271`
- Введите название дисциплины: `'; DROP TABLE STUDENT; --`
- **Ожидаемый результат**: Система обнаружит инъекцию и выведет предупреждение

### Шаг 4: Демонстрация работы обычного пользователя (junior)

1. **Запустите программу заново**
2. **Выберите**: `2` (Пользователь)
3. **Введите логин**: `sab_junior`
4. **Введите пароль**: `123456`

#### Тест 6: Просмотр оценок (доступно)
- Выберите пункт меню: `1`
- Введите ID студента: `856271`
- Должны отобразиться все оценки студента

#### Тест 7: Поиск студента по ФИО
- Выберите пункт меню: `2`
- Введите фамилию: `Михеев`
- Введите имя: `Александр`
- Введите номер группы: `123`
- Должна отобразиться информация о студенте

#### Тест 8: Попытка SQL-инъекции от пользователя
- Выберите пункт меню: `3` (Тест SQL-инъекции)
- Введите вредоносный запрос: `1' OR 1=1; UPDATE FIELD_COMPREHENSION SET MARK=5; --`
- **Ожидаемый результат**: Система обнаружит и заблокирует инъекцию

### Шаг 5: Проверка ограничений прав junior

Попробуйте подключиться от имени `sab_junior` и выполнить операции изменения:
- Junior пользователь НЕ имеет прав на INSERT, UPDATE, DELETE
- Все попытки изменить данные будут отклонены на уровне базы данных

---

## ПРИМЕРЫ ВЫХОДНЫХ ДАННЫХ

### Успешный вход администратора:
```
=== СИСТЕМА УПРАВЛЕНИЯ БАЗОЙ ДАННЫХ СТУДЕНТОВ ===

Выберите тип пользователя:
1. Администратор (admin)
2. Пользователь (junior)
Ваш выбор: 1

Введите имя пользователя БД (например, sab_admin): sab_admin
Введите пароль: 123456

✓ Успешное подключение к базе данных!
Роль пользователя: admin
```

### Обнаружение SQL-инъекции:
```
⚠️  ВНИМАНИЕ! Обнаружена попытка SQL-инъекции!
Пользователю вынесено предупреждение.
Попытка выполнения опасного запроса заблокирована.
```

### Просмотр оценок:
```
Все оценки студента:
surname         name            group_number    field_name      mark
----------------------------------------------------------------
Михеев          Александр       123             Базы данных     5
Михеев          Александр       123             Математика      4
```

---

## КОНТРОЛЬНЫЕ ВОПРОСЫ И ОТВЕТЫ

### 1. Как возможно установить соединение с базой данных на языке С?
**Ответ**: Используется функция `PQconnectdb()` из библиотеки libpq:
```cpp
PGconn *conn = PQconnectdb("host=localhost dbname=students user=sab_admin password=123456");
```

### 2. Что такое SQL инъекция?
**Ответ**: SQL-инъекция — это атака, при которой злоумышленник внедряет вредоносный SQL-код через пользовательский ввод, что может привести к несанкционированному доступу, изменению или удалению данных.

### 3. Какие методы защиты от SQL инъекций вы знаете?
**Ответ**:
- Параметризированные запросы (PQexecParams)
- Экранирование специальных символов (PQescapeStringConn)
- Валидация и фильтрация пользовательского ввода
- Использование prepared statements
- Ограничение прав доступа пользователей БД

### 4. Для чего предназначены функции PQclear и PQfinish?
**Ответ**:
- `PQclear()` — освобождает память, выделенную под результат запроса (PGresult)
- `PQfinish()` — закрывает соединение с сервером БД и освобождает память объекта PGconn

### 5. В чем преимущества использования параметризованных запросов?
**Ответ**:
- Автоматическая защита от SQL-инъекций
- Не требуется ручное экранирование символов
- Повышенная безопасность
- Улучшенная производительность (при многократном использовании)
- Читаемость кода

---

## ЗАДАНИЕ 2.3: Использование представлений

### Создание представления:
```sql
CREATE VIEW student_marks_view AS
SELECT 
    S.STUDENT_ID,
    S.SURNAME,
    S.NAME,
    S.GROUP_NUMBER,
    F.FIELD_NAME,
    F_C.MARK
FROM STUDENT S
JOIN FIELD_COMPREHENSION F_C ON S.STUDENT_ID = F_C.STUDENT_ID
JOIN FIELD F ON F.FIELD_ID = F_C.FIELD;
```

### Преимущества использования представлений:
1. **Упрощение запросов** - сложные JOIN скрыты внутри представления
2. **Безопасность** - можно ограничить доступ к определенным столбцам
3. **Абстракция данных** - изменения в структуре таблиц не влияют на приложение
4. **Переиспользование логики** - одно представление для разных запросов

### Недостатки:
1. **Производительность** - представления могут работать медленнее прямых запросов

### Сценарий 4: Безопасный поиск
✅ Параметризированный запрос → SQL-инъекция невозможна

## ВЫВОД

Программа полностью реализует все требования лабораторной работы:
- ✅ Защита от SQL-инъекций (3 метода)
- ✅ Аутентификация с ролями
- ✅ CRUD операции с проверкой прав
- ✅ Обнаружение и блокировка вредоносных запросов
- ✅ Параметризированные запросы
- ✅ Удобный пользовательский интерфейс

Код написан на C++ с использованием библиотеки libpq для работы с PostgreSQL.

