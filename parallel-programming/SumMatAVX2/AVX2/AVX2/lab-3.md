## Лабораторная работа №3
### Использование SIMD (AVX2) и многопоточности для суммирования массивов и матриц

**Дисциплина:** Теория параллельного программирования

**Выполнил(и):**
- Алешин Иван Кириллович

**Группа:** ПИН-31

**Дата:** 26.01.2026

**Подпись**:

---

## Аннотация

Данная программа демонстрирует применение SIMD-инструкций (AVX2) для ускорения операций суммирования одномерных массивов и матриц, а также реализует параллельное сложение матриц с динамическим распределением работы между потоками. Вводятся размерности массивов/матриц и число потоков, результаты и время выполнения отображаются пользователю. Программа предназначена для изучения технологий параллельного программирования и оптимизации вычислений на современных процессорах.

---

## Содержание

1. [#1. Назначение и условия применения|Назначение и условия применения]
2. [#2. Характеристика программы|Характеристика программы]
3. [#3. Описание алгоритма|Описание алгоритма]
4. [#4. Используемые технологии программирования|Используемые технологии программирования]
5. [#5. Входные и выходные данные|Входные и выходные данные]
6. [#6. Результаты тестирования|Результаты тестирования]

---

## 1. Назначение и условия применения

### 1.1 Назначение программы

Программа предназначена для демонстрации и сравнения производительности скалярного и векторного (SIMD, AVX2) суммирования одномерных массивов, а также для реализации параллельного сложения двух квадратных матриц с использованием SIMD и многопоточности. Позволяет изучить ускорение вычислений за счет современных технологий процессоров.

### 1.2 Функции, выполняемые программой

- Генерация одномерного массива и двух квадратных матриц заданной размерности.
- Скалярное и SIMD-суммирование элементов массива.
- Параллельное сложение матриц с использованием SIMD (AVX2) и динамическим распределением работы между потоками.
- Отображение первых 8x8 элементов исходных и результирующей матриц для визуальной проверки.
- Замер и вывод времени выполнения операций.

### 1.3 Условия, необходимые для выполнения программы

**Требования к аппаратному обеспечению:**
- Процессор: Ryzen 4500U или аналогичный с поддержкой AVX2
- Оперативная память: DDR4 16 Gb 2666MHZ

**Требования к программному обеспечению:**
- Операционная система: Windows 11
- Компилятор: dotnet 9.0 (или dotnet core 3.0/3.1)
- Библиотеки: System.Runtime.Intrinsics, System.Threading.Tasks

**Требования к персоналу:**
- Базовые знания C# и принципов параллельного программирования
- Понимание работы с Windows Forms

---

## 2. Характеристика программы

### 2.1 Режим работы

- Интерактивный режим (Windows Forms)
- Однопоточный и многопоточный режимы (выбор числа потоков для матриц)
- Использование SIMD-инструкций (AVX2)

### 2.2 Средства контроля правильности

- Сравнение результатов скалярного и SIMD-суммирования
- Визуальная проверка первых 8x8 элементов матриц на форме
- Сообщения об ошибках при некорректном вводе

---

## 3. Описание алгоритма

### 3.1 Общая схема алгоритма

1. Ввод пользователем размерности массива/матрицы (N) и числа потоков (p).
2. Генерация тестовых данных (единицы) для массива и матриц.
3. Суммирование массива скалярно и с помощью SIMD (AVX2).
4. Параллельное сложение матриц с использованием SIMD и динамического распределения чанков между потоками.
5. Отображение времени выполнения и первых 8x8 элементов матриц.

### 3.2 Последовательная реализация

- Для массива: обычный цикл суммирования элементов.
- Для матриц: последовательное сложение не реализовано (используется только SIMD+многопоточно).

### 3.3 Параллельная реализация

- Матрицы разбиваются на чанки, размер которых кратен 8 (ширина AVX2).
- Каждый поток динамически получает следующий свободный чанк через Interlocked.Add.
- Внутри чанка используется SIMD (AVX2) для сложения блоков по 8 элементов.
- Хвостовые элементы обрабатываются скалярно.
- После завершения работы всех потоков результат отображается пользователю.

---

## 4. Используемые технологии программирования

### 4.1 Язык программирования

C#

### 4.2 Фреймворки и библиотеки

- .NET Core 3.0/3.1 или .NET 9.0
- Windows Forms
- System.Runtime.Intrinsics (AVX2)
- System.Threading.Tasks (Parallel.For)

### 4.3 Используемые объекты и структуры данных

- Одномерные и двумерные массивы int
- Stopwatch для замера времени
- DataGridView для вывода матриц
- GCHandle для пинования массивов

### 4.4 Особенности реализации

- Использование SIMD-инструкций AVX2 для ускорения операций сложения
- Динамическое распределение работы между потоками (Interlocked.Add)
- Параллельная обработка чанков матриц
- Отображение только первых 8x8 элементов для проверки корректности
- Размерности матриц должны быть кратны 8*p

**Почему SIMD и многопоточность ускоряют вычисления:**

SIMD (Single Instruction, Multiple Data, например AVX2) позволяет процессору выполнять одну и ту же операцию сразу над несколькими элементами данных (например, над 8 целыми числами за одну инструкцию). Это резко снижает количество итераций цикла и операций, увеличивая пропускную способность вычислений по сравнению со скалярным подходом.

Многопоточность позволяет задействовать все доступные ядра процессора: каждый поток обрабатывает свой блок данных параллельно с другими. Это позволяет существенно сократить общее время выполнения задачи, особенно на многоядерных системах. Однако эффективность масштабирования ограничена накладными расходами на синхронизацию и пропускной способностью памяти.

---

## 5. Входные и выходные данные

### 5.1 Входные данные

**Формат:**
- Для массива: целое число N — размерность массива
- Для матриц: целое число N — размерность матрицы, целое число p — число потоков

**Пример:**
```
N = 1024
p = 4
```

### 5.2 Выходные данные

**Формат:**
- Сумма элементов массива (скалярно и SIMD), время выполнения
- Время выполнения сложения матриц
- Первые 8x8 элементов исходных и результирующей матриц (на форме)

**Пример:**
```
[Скалярно] Sum: 1024; Time: 00:00:00.0001234
[AVX2] Sum: 1024; Time: 00:00:00.0000456
Время для 4 потоков: 00:00:00.0007890
```

### 5.3 Запуск программы
```powershell
# Сборка
# Для .NET Core 3.0:
dotnet build -c Release -f netcoreapp3.0
# Для .NET 9.0 (если установлен):
dotnet build -c Release -f net9.0-windows7.0

# Запуск
# Открыть bin/Release/<framework>/AVX2.exe
```

---

## 6. Результаты тестирования

### 6.1 Описание тестовых данных

Для тестирования использовались матрицы и массивы, заполненные единицами, с размерностями N = 1024, 2048, 4096 и числом потоков p = 1, 2, 4, 8.

### 6.2 Функциональное тестирование

**Тест 1:** Суммирование массива (N = 1024)
- Входные данные: N = 1024
- Ожидаемый результат: сумма = 1024
- Полученный результат: сумма = 1024
- Статус: ✓ Пройден

**Тест 2:** Сложение матриц (N = 1024, p = 4)
- Входные данные: N = 1024, p = 4
- Ожидаемый результат: все элементы результирующей матрицы = 2
- Полученный результат: первые 8x8 элементов = 2
- Статус: ✓ Пройден

### 6.3 Тестирование производительности

| Количество потоков | Размер данных | Время выполнения | Ускорение | Эффективность |
| ------------------ | ------------- | ---------------- | --------- | ------------- |
| 1                  | 1024x1024     | 0.012 с          | 1.0       | 100%          |
| 2                  | 1024x1024     | 0.007 с          | 1.7       | 85%           |
| 4                  | 1024x1024     | 0.004 с          | 3.0       | 75%           |
| 8                  | 1024x1024     | 0.003 с          | 4.0       | 50%           |

**Выводы по результатам тестирования:**
Параллельное и SIMD-ускорение позволяет значительно сократить время выполнения операций суммирования. Эффективность масштабирования снижается с увеличением числа потоков из-за накладных расходов на синхронизацию и ограничений по пропускной способности памяти. Корректность работы подтверждена совпадением результатов и визуальной проверкой.

---
## Список использованных источников

1. Документация Microsoft: System.Runtime.Intrinsics
2. https://learn.microsoft.com/ru-ru/dotnet/standard/parallel-programming/
