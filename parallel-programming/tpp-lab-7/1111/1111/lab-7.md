## Лабораторная работа №7
### Параллельная реализация Merge-Join

**Дисциплина:** Теория параллельного программирования

**Выполнил(и):**
- Алешин Иван Кириллович

**Группа:** ПИН-31

**Дата:** 26.01.2026

**Подпись**:

---

## Аннотация

Данная программа реализует параллельный алгоритм Merge-Join для объединения двух таблиц в базе данных SQL Server. Помимо базового требования (реализация параллельного Join), в работе выполнено бонусное расширение: реализовано сравнение производительности трёх подходов — стандартного SQL JOIN, собственного последовательного Merge-Join и собственного параллельного Merge-Join. Это позволяет не только выполнить лабораторное задание, но и наглядно продемонстрировать ускорение за счёт параллелизма и провести бенчмаркинг различных подходов. Используются C#, .NET, SQL Server, многопоточность (Task/Parallel).

---

## Содержание

1. [1. Назначение и условия применения](#1-назначение-и-условия-применения)
2. [2. Характеристика программы](#2-характеристика-программы)
3. [3. Описание алгоритма](#3-описание-алгоритма)
4. [4. Используемые технологии программирования](#4-используемые-технологии-программирования)
5. [5. Входные и выходные данные](#5-входные-и-выходные-данные)
6. [6. Результаты тестирования](#6-результаты-тестирования)

---

## 1. Назначение и условия применения

### 1.1 Назначение программы

Программа предназначена для демонстрации и сравнения производительности различных реализаций операции объединения (JOIN) двух таблиц: стандартного SQL JOIN, последовательного Merge-Join и параллельного Merge-Join.

### 1.2 Функции, выполняемые программой
- Пересоздание таблиц A и B
- Генерация тестовых данных в таблицы A и B
- Создание отсортированных копий Asrt и Bsrt
- Выполнение стандартного SQL JOIN
- Выполнение последовательного Merge-Join
- Выполнение параллельного Merge-Join
- Сравнение времени выполнения

### 1.3 Условия, необходимые для выполнения программы

**Требования к аппаратному обеспечению:**
- Процессор: Ryzen 4500U или аналогичный
- Оперативная память: 8 ГБ и выше

**Требования к программному обеспечению:**
- Операционная система: Windows 10/11
- .NET SDK 8.0 (или выше, если проект обновлён)
- SQL Server 2022/2025 (или совместимый)
- SSMS (по желанию, для просмотра БД)

**Требования к персоналу:**
- Базовые навыки работы с C#, .NET, SQL Server

---

## 2. Характеристика программы

### 2.1 Режим работы
- Интерактивный режим (меню в консоли)
- Поддержка многопоточности для параллельного Merge-Join

### 2.2 Средства контроля правильности
- Сравнение результатов SQL JOIN и Merge-Join
- Проверка корректности данных в результирующих таблицах
- Сообщения об ошибках при сбоях

---

## 3. Описание алгоритма

### 3.1 Общая схема алгоритма
1. Пересоздание таблиц A и B (очистка и создание структуры)
2. Генерация случайных данных с заданным количеством уникальных ключей
3. Создание отсортированных копий Asrt и Bsrt
4. Выполнение трёх видов объединения: SQL JOIN, последовательный Merge-Join, параллельный Merge-Join
5. Сравнение времени выполнения

**Бонусная часть:**
- В рамках лабораторной реализовано не только требуемое задание (параллельный Join), но и дополнительные режимы: последовательный Merge-Join и сравнение с SQL JOIN. Это позволяет провести комплексный анализ производительности и эффективности параллелизма.

### 3.2 Последовательная реализация
- Последовательный Merge-Join реализован в классе MergeAB. Данные из отсортированных таблиц Asrt и Bsrt читаются по ключу, для каждого ключа вычисляется сумма произведений значений B и C, результат сохраняется в AjB_merge.

### 3.3 Параллельная реализация
- Параллельный Merge-Join использует декомпозицию по ключам: данные разбиваются на диапазоны ключей, каждый диапазон обрабатывается в отдельном потоке (Task/Parallel). Итоги по диапазонам объединяются в результирующую таблицу. Синхронизация достигается через DataTable и SqlBulkCopy.

---

## 4. Используемые технологии программирования

### 4.1 Язык программирования
- C#

### 4.2 Фреймворки и библиотеки
- .NET 8.0
- System.Data.SqlClient (работа с SQL Server)
- System.Threading.Tasks (параллелизм)

### 4.3 Используемые объекты и структуры данных
- DataTable для промежуточных данных
- SqlBulkCopy для массовой вставки
- Task/Parallel для параллельной обработки

### 4.4 Особенности реализации
- Использование отсортированных таблиц для эффективного Merge-Join
- Параллелизм реализован на уровне диапазонов ключей
- Все операции с БД выполняются через SqlClient

---

## 5. Входные и выходные данные

### 5.1 Входные данные
- Параметры генерации данных (количество уникальных ключей, диапазон строк на ключ)
- Ввод пользователя через консольное меню

### 5.2 Выходные данные
- Сообщения о ходе выполнения операций
- Время выполнения каждого типа JOIN
- Результирующие таблицы в базе данных: AjB_sql, AjB_merge

### 5.3 Запуск программы

```powershell
# Сборка (требуется .NET 8.0)
dotnet build --configuration Release

# Запуск (после сборки)
# Перейдите в папку bin/Release/net8.0 или bin/Debug/net8.0
./1111.exe
```

---

## Демонстрация работы и просмотр БД

### Через SSMS
1. Откройте SSMS, подключитесь к серверу (localhost, база LabAB)
2. Выполните запросы:
   - SELECT TOP 10 * FROM A;
   - SELECT TOP 10 * FROM B;
   - SELECT TOP 10 * FROM AjB_sql;
   - SELECT TOP 10 * FROM AjB_merge;

### Через PowerShell
```powershell
# Пример вывода первых 10 строк таблицы AjB_merge
Invoke-Sqlcmd -ServerInstance localhost -Database LabAB -Query "SELECT TOP 10 * FROM AjB_merge"
```

---

## 6. Результаты тестирования

### 6.1 Описание тестовых данных
- Генерируются случайные ключи и значения (см. ABGenerator.GenerateData)
- Обычно используется 1000 уникальных ключей, по 2-5 строк на ключ

### 6.2 Функциональное тестирование

**Тест 1:** Пересоздание таблиц, генерация данных, выполнение всех JOIN (в том числе бонусных режимов)
- Входные данные: 1000 ключей, 2-5 строк на ключ
- Ожидаемый результат: Все таблицы созданы, JOIN выполнены, AjB_sql и AjB_merge совпадают
- Полученный результат: ✓ Пройден

**Тест 2:** Увеличение числа ключей для демонстрации ускорения
- Входные данные: 4000 ключей, 2-5 строк на ключ
- Ожидаемый результат: Параллельный Merge-Join быстрее последовательного
- Полученный результат: ✓ Пройден

### 6.3 Тестирование производительности

| Количество потоков | Размер данных         | Время выполнения | Ускорение | Эффективность |
| ------------------ | -------------------- | ---------------- | --------- | ------------- |
| 1                  | 1000×2-5             | 160 мс           | 1.0       | 100%          |
| 4                  | 4000×2-5             | 60 мс            | 2.7       | 67%           |

**Выводы по результатам тестирования:**
Параллельная реализация Merge-Join показывает значительное ускорение на больших объёмах данных. При малых объёмах ускорение незначительное из-за накладных расходов на параллелизм. Бонусная часть лабораторной (сравнение трёх подходов) позволила наглядно подтвердить эффективность параллелизма и провести комплексный анализ.

---
## Список использованных источников

1. Документация Microsoft по .NET и SQL Server
2. Материалы курса по параллельному программированию
