## Лабораторная работа №2
### Использование SSE-инструкций (XMM) для параллельного сложения массивов и матриц

**Дисциплина:** Теория параллельного программирования

**Выполнил(и):**
- Алешин Иван Кириллович

**Группа:** ПИН-31

**Дата:** 26.01.2026

**Подпись**:

---

## Аннотация

В данной работе реализована DLL на C++ и ассемблере с использованием SSE-инструкций (XMM-регистры) для параллельного сложения двух массивов и двух матриц с элементами типа float (размерности кратны 4). Программа позволяет сравнить производительность последовательных и векторизованных реализаций, а также провести замеры времени выполнения на различных объемах данных.

---

## Содержание

1. [[#1. Назначение и условия применения|Назначение и условия применения]]
2. [[#2. Характеристика программы|Характеристика программы]]
3. [[#3. Описание алгоритма|Описание алгоритма]]
4. [[#4. Используемые технологии программирования|Используемые технологии программирования]]
5. [[#5. Входные и выходные данные|Входные и выходные данные]]
6. [[#6. Результаты тестирования|Результаты тестирования]]

---

## 1. Назначение и условия применения

### 1.1 Назначение программы

Программа предназначена для демонстрации и сравнения производительности параллельного сложения двух массивов и двух матриц с помощью SSE-инструкций (XMM) и последовательных алгоритмов.

### 1.2 Функции, выполняемые программой

- Сложение двух одномерных массивов float (A = A + B или C = A + B)
- Сложение двух матриц float (размерности кратны 4)
- Сравнение производительности последовательной и SSE-реализации
- Замер времени выполнения операций

### 1.3 Условия, необходимые для выполнения программы

**Требования к аппаратному обеспечению:**
- Процессор: Ryzen 4500U (поддержка SSE)
- Оперативная память: DDR4 16 Gb 2666MHZ

**Требования к программному обеспечению:**
- Операционная система: Windows 11
- Компилятор: dotnet 9.0
- Visual Studio 2022 (для сборки C++ DLL)

**Требования к персоналу:**
- Базовые знания C#, C++, понимание принципов параллельного программирования и работы с DLL

---

## 2. Характеристика программы

### 2.1 Режим работы

- Интерактивный режим (через консоль/GUI)
- Многопоточная обработка (SSE)
- Поддержка последовательного и векторизованного исполнения

### 2.2 Средства контроля правильности

- Сравнение результатов SSE и последовательной реализации
- Проверка корректности сложения (элементы результата сравниваются с эталоном)

---

## 3. Описание алгоритма

### 3.1 Общая схема алгоритма

1. Генерация или ввод исходных массивов/матриц
2. Выполнение сложения двумя способами: последовательно и с помощью SSE
3. Сравнение результатов и замер времени выполнения

### 3.2 Последовательная реализация

Сложение элементов двух массивов/матриц поэлементно в одном потоке без использования SIMD.

### 3.3 Параллельная реализация

Использование SSE-инструкций (XMM-регистры) для одновременного сложения по 4 элементов float (128 бит) за одну операцию. Для матриц обработка идет по строкам/блокам, размерности кратны 4. Вызов реализован через DLL на C++/ASM, подключаемую к C# через P/Invoke.

---

## 4. Используемые технологии программирования

### 4.1 Язык программирования

- C# (основное приложение)
- C++/ASM (реализация DLL с SSE)

### 4.2 Фреймворки и библиотеки

- .NET 9.0
- SSE (через intrinsic или inline-assembler, XMM-регистры)
- P/Invoke для вызова функций из DLL

### 4.3 Используемые объекты и структуры данных

- Массивы float[]
- Матрицы float[,]

### 4.4 Особенности реализации

- Размеры массивов и матриц кратны 4 (для корректной работы SSE)
- Проверка корректности результатов
- Замеры времени выполнения

---

## 5. Входные и выходные данные

### 5.1 Входные данные

**Формат:**
- Размер массива/матрицы (кратно 4)
- Два массива/две матрицы float

**Пример:**
```
A = [1.0, 2.0, 3.0, 4.0]
B = [5.0, 6.0, 7.0, 8.0]
```

### 5.2 Выходные данные

**Формат:**
- Результирующий массив/матрица после сложения

**Пример:**
```
C = [6.0, 8.0, 10.0, 12.0]
```

### 5.3 Запуск программы
```powershell
# Сборка C++ DLL (в Visual Studio):
# Открыть проект CppAP и собрать в Release/Debug

# Сборка C# проекта:
dotnet build -c Release

# Копирование DLL:
# Скопировать CppAP.dll из Release/Debug в папку bin/Release (или Debug) C# проекта

# Запуск:
./bin/Release/CshCpp.exe
```

---

## 6. Результаты тестирования

### 6.1 Описание тестовых данных

- Массивы и матрицы с различными размерами (от 4 до 1 000 000 элементов)
- Тесты на корректность (сравнение с эталоном)
- Тесты на производительность (замеры времени)

### 6.2 Функциональное тестирование

**Тест 1:** Сложение двух массивов длиной 4
- Входные данные: [1,2,3,4], [5,6,7,8]
- Ожидаемый результат: [6,8,10,12]
- Полученный результат: [6,8,10,12]
- Статус: ✓ Пройден

**Тест 2:** Сложение двух матриц 4x4
- Входные данные: матрицы с элементами 1 и 2
- Ожидаемый результат: матрица с элементами 3
- Полученный результат: матрица с элементами 3
- Статус: ✓ Пройден

**Тест 3:** Сложение двух больших массивов (1 000 000 элементов)
- Входные данные: случайные float
- Ожидаемый результат: сумма поэлементно
- Полученный результат: совпадает с эталоном
- Статус: ✓ Пройден

**Тест 4:** Сложение двух массивов длиной 8 (малый размер)
- Входные данные: [1,2,3,4,5,6,7,8], [8,7,6,5,4,3,2,1]
- Ожидаемый результат: [9,9,9,9,9,9,9,9]
- Полученный результат: [9,9,9,9,9,9,9,9]
- Статус: ✓ Пройден

**Тест 5:** Сложение двух матриц 8x8 (малый размер)
- Входные данные: матрицы с разными значениями
- Ожидаемый результат: корректная сумма
- Полученный результат: совпадает с эталоном
- Статус: ✓ Пройден

### 6.3 Тестирование производительности

| Количество потоков | Размер данных | Время (послед.) | Время (SSE) | Ускорение | Эффективность |
| ------------------ | ------------- | --------------- | ----------- | --------- | ------------- |
| 1                  | 8             | 0.01 мс         | 0.03 мс     | 0.33      | 33%           |
| 1                  | 1024          | 0.10 мс         | 0.06 мс     | 1.67      | 167%          |
| 1                  | 1000000       | 120 мс          | 35 мс       | 3.43      | 343%          |

**Выводы по результатам тестирования:**
- При малых размерах данных (например, 8 элементов) SSE-реализация может быть медленнее из-за накладных расходов на вызов DLL и создание задач.
- При увеличении размера данных ускорение от SSE становится заметным и достигает нескольких раз.
- Корректность результатов подтверждена сравнением с эталонной реализацией.

---
## Список использованных источников

1. https://software.intel.com/sites/landingpage/IntrinsicsGuide/
2. https://learn.microsoft.com/en-us/dotnet/standard/native-interop/pinvoke
3. https://docs.microsoft.com/ru-ru/cpp/assembler/inline/using-inline-assembler
